create database Olympic;
use olympic;

create table OLYMPIC_REPORT(
ID double,
NAME TEXT,
SEX TEXT,
AGE BIGINT,
HEIGHT TEXT,
WEIGHT TEXT,
NOC TEXT,
TEAM TEXT,
GAMES TEXT,
YEAR DOUBLE,
Season TEXT,
City TEXT,
Sport TEXT,
Event TEXT,
Medal TEXT);

SELECT * FROM olympic_report;

/*MEDAL TALLY*/

/*Q1. WHICH top 5 TEAM GOT THE MOST MEDALS IN SUMMER & WINTER OLYMPICS COMBINED?*/
select TEAM, `TOTAL COUNT OF MEDALS`, RANKING
FROM 
(SELECT TEAM,  COUNT(*) AS `TOTAL COUNT OF MEDALS`,
dense_rank() OVER( ORDER BY COUNT(*) DESC) AS RANKING
FROM OLYMPIC_REPORT
WHERE MEDAL NOT LIKE "NA" 
GROUP BY TEAM
ORDER BY `TOTAL COUNT OF MEDALS` DESC)AS TT
WHERE RANKING <6;

/*Q2.ANALYSIS OF TOP3 TEAMS IN DIFFERENT SEASONS WITH THEIR MEDAL TALLY*/
/*TOP TEAM GETTING MEDAL IN SUMMER  OLYMPIC */
SELECT TEAM, COUNT(MEDAL) AS TOTAL
FROM olympic_report
WHERE SEASON='SUMMER' AND MEDAL<>'NA' 
GROUP BY TEAM
ORDER BY TOTAL DESC
LIMIT 1;

/* TOP TEAM GETTING MEDAL IN WINTER  OLYMPIC */
SELECT TEAM, COUNT(MEDAL) AS TOTAL
FROM olympic_report
WHERE SEASON='WINTER' AND MEDAL<>'NA' 
GROUP BY TEAM
ORDER BY TOTAL DESC
LIMIT 1;

/*TREND IN INDIA , PARTICIPATING IN THE TWO DIFFERENT SEASON OF OLYMPIC?*/
SELECT CONCAT(ROUND((WINTER /TOTAL_PLAYERS_PLAYED *100),0),"%") AS `WINTER %`, 
CONCAT(ROUND((SUMMER/TOTAL_PLAYERS_PLAYED *100),0),"%") AS `SUMMER %`
FROM 
(SELECT TEAM, SUM(IF(SEASON ='WINTER',1,0)) AS WINTER , SUM(IF(SEASON= 'SUMMER',1,0)) AS SUMMER, 
(SUM(IF(SEASON ='WINTER',1,0))+ SUM(IF(SEASON= 'SUMMER',1,0))) AS TOTAL_PLAYERS_PLAYED,
COUNT(NAME) AS TOTAL_PARTICIPANTS
FROM olympic_report
WHERE TEAM= 'INDIA') AS TT
GROUP BY TEAM
ORDER BY TOTAL_PARTICIPANTS DESC;

/*Q.4 TOP 10 SPORTS GETTING THE MOST MEDALS*/
SELECT SPORT, COUNT(MEDAL) AS TOTAL
FROM olympic_report
WHERE MEDAL <> 'NA'
GROUP BY SPORT
ORDER BY TOTAL DESC
LIMIT 10;

/*Q5. WHICH PERSON GOT THE MOST MEDALS IN SUMMER OLYMPICS AND HOW MANY 
(ALSO REPRESENT THE TEAM AND YEAR ACHIEVED)?*/
SELECT NAME, TEAM,
sum(MEDAL="GOLD") AS GOLD,
SUM(MEDAL="SILVER") AS SILVER,
sum(MEDAL="BRONZE") AS BRONZE,
COUNT(*) AS TOTAL
FROM olympic_report
WHERE SEASON LIKE "SUMMER" AND MEDAL <> "NA"  
GROUP BY NAME,TEAM
ORDER BY TOTAL DESC
LIMIT 1;

/*Q6. NAME OF THE PLAYER WHO GOT MOST NUMBER OF MEDALS AMONG ALL AND ALSO
REPRESENTING HIS/HER COUNTRY AND HIS SPORT OF SUMMER OLYMPICS OF 1992?*/
SELECT NAME, SEX, COUNT(MEDAL) AS TOTAL_MEDAL, TEAM, SPORT
FROM olympic_report
WHERE GAMES LIKE '1992_SUMMER' AND MEDAL NOT LIKE 'NA'
GROUP BY NAME
ORDER BY TOTAL_MEDAL DESC
LIMIT 5;

/*Q7. WHAT IS THE GROWTH% OF INDIA IN TERMS OF MEDALS EARNED OVER THE PAST YEARS?*/
SELECT TEAM, YEAR,
IF(@LAST_YEAR= 0,0,CONCAT(ROUND(((TOTAL-@LAST_YEAR)/@LAST_YEAR)*100,2),"%")) AS `GROWTH RATE`,
@LAST_YEAR:=TOTAL
FROM
(SELECT @LAST_YEAR:=0) AS X,
(SELECT TEAM, YEAR, COUNT(MEDAL) AS TOTAL
FROM olympic_report
WHERE TEAM= 'INDIA' AND MEDAL<> 'NA'
GROUP BY YEAR
ORDER BY YEAR) AS Y;

/*Q8. ANALYSIS OF DOWNFALL OF INDIA*/
CREATE VIEW ALL_PARTICIPANTS AS
(SELECT NAME, COUNT(MEDAL) AS NO_OF_GAMES_PLAYED, TEAM, YEAR
FROM olympic_report
GROUP BY NAME, YEAR
ORDER BY YEAR);
SELECT * FROM all_participants;

CREATE VIEW ONLY_WHO_EARNED_MEDALS AS
(SELECT NAME, COUNT(MEDAL) AS NO_OF_GAMES_PLAYED, TEAM, YEAR
FROM olympic_report
WHERE MEDAL <> "NA"
GROUP BY NAME, YEAR
ORDER BY YEAR);
SELECT * FROM ONLY_WHO_EARNED_MEDALS;

/*HERE I HAVE SHOWN THE EFFICIENCY RATE*/
WITH CTE1
AS (SELECT YEAR, COUNT(NAME) AS ONLY_THOSE_WHO_EARNED_MEDALS
FROM olympic_report
WHERE YEAR IN ( 1924, 1996,2008,2016) AND TEAM= "INDIA" AND MEDAL <> "NA"
GROUP BY YEAR
ORDER BY YEAR),
CTE2 AS (SELECT YEAR, COUNT(NAME) AS ALL_PLAYERS_PLAYED
FROM olympic_report
WHERE YEAR IN ( 1924, 1996,2008,2016) AND TEAM= "INDIA" 
GROUP BY YEAR
ORDER BY YEAR)
SELECT CTE1.YEAR, ONLY_THOSE_WHO_EARNED_MEDALS, ALL_PLAYERS_PLAYED,
CONCAT(ROUND(( ONLY_THOSE_WHO_EARNED_MEDALS/ALL_PLAYERS_PLAYED*100),0),"%") AS EFFICIENCY_RATE
FROM CTE1 JOIN CTE2 USING (YEAR);

/*Q. COMPARISION */
/*PARTICIPATION RATE OF INDIA AND USA FOR OVERALL YEARS*/
SELECT USA, INDIA, CONCAT(ROUND((USA/TOTAL_PLAYERS*100),0),"%") AS USA_ACHV_RATE,
CONCAT(ROUND((INDIA/TOTAL_PLAYERS*100),0),"%") AS INDIA_ACHV_RATE
FROM
(SELECT SUM(IF(TEAM="USA",1,0)) AS USA, SUM(IF(TEAM="INDIA",1,0)) AS INDIA,
SUM(IF(TEAM="USA",1,0))+SUM(IF(TEAM="INDIA",1,0)) AS TOTAL_PLAYERS
FROM olympic_report) AS TT;

/* RATE OF MEDALS_EARNED BY USA AND INDIA*/
SELECT  INDIA, USA, CONCAT(ROUND(((INDIA/TOTAL_MEDALS)*100),0),"%") AS `INDIA MEDAL EARNED PERC`, 
CONCAT(ROUND(((USA/TOTAL_MEDALS)*100),0),"%") AS `USA MEDAL EARNED PERC`
FROM
(SELECT  SUM(IF(TEAM="INDIA",1,0)) AS INDIA , SUM(IF(TEAM="USA",1,0)) AS USA,
(SUM(IF(TEAM="INDIA",1,0)))+(SUM(IF(TEAM="USA",1,0))) AS TOTAL_MEDALS
FROM olympic_report
WHERE MEDAL <> "NA" ) AS TT;

/*CALCULATING THE EFFICIENCY RATE OF USA AND INDIA*/
WITH PARTICIPATION_RATE AS 
(SELECT USA1, INDIA1, CONCAT(ROUND((USA1/TOTAL_PLAYERS*100),0),"%") AS USA_part_RATE,
CONCAT(ROUND((INDIA1/TOTAL_PLAYERS*100),0),"%") as india_part_rate
FROM
(SELECT  SUM(IF(TEAM="USA",1,0)) AS USA1, SUM(IF(TEAM="INDIA",1,0)) AS INDIA1,
SUM(IF(TEAM="USA",1,0))+SUM(IF(TEAM="INDIA",1,0)) AS TOTAL_PLAYERS
FROM olympic_report)as tt1),
MEDAL_RATE AS
(SELECT INDIA2, USA2, CONCAT(ROUND(((INDIA2/TOTAL_MEDALS)*100),0),"%") AS INDIA_MEDAL_EARNED_PERC, 
CONCAT(ROUND(((USA2/TOTAL_MEDALS)*100),0),"%") AS usa_MEDAL_EARNED_PERC
FROM
(SELECT  SUM(IF(TEAM="INDIA",1,0)) AS INDIA2 , SUM(IF(TEAM="USA",1,0)) AS USA2,
(SUM(IF(TEAM="INDIA",1,0)))+(SUM(IF(TEAM="USA",1,0))) AS TOTAL_MEDALS
FROM olympic_report
WHERE MEDAL <> "NA")as tt2)
SELECT CONCAT(ROUND(((MEDAL_RATE.INDIA2/PARTICIPATION_RATE.INDIA1)*100),0),"%") AS `EFFICIENCY RATE OF INDIA`, 
CONCAT(ROUND(((MEDAL_RATE.USA2/PARTICIPATION_RATE.USA1)*100),0),"%") AS `EFFICIENCY RATE OF USA`
FROM PARTICIPATION_RATE JOIN MEDAL_RATE;

/*GROWTH % INDIA VS USA IN COMPARISION TO 2012-2016*/
select year,team, CONCAT(ROUND(((_2016-_2012)/_2012)*100,2),"%") as EFF_RATE_
from
(SELECT YEAR,team, COUNT(MEDAL), sum(if(year="2012",1,0)) as _2012, sum(if(year="2016",1,0)) as _2016
FROM olympic_report
WHERE year in (2012,2016) and team in  ("india","usa") and medal <> "na"
group by  team
order by  year) AS TT
group by TEAM
ORDER BY YEAR;

/*MEDAL ANALYSIS- GENDER VARIATION*/
/*Q10.
(A) WHO WON THE MOST MEDALS (M/F) MEDAL WISE?*/
SELECT MEDAL, COUNT(MEDAL) AS TOTAL , SEX,
dense_rank () OVER (order by COUNT(MEDAL)) AS D_RANK
FROM olympic_report
WHERE MEDAL <> 'NA'
GROUP By SEX, medal
order by D_RANK DESC;

/*Q.10(B) OVERALL VS M/F MEDAL COUNT AND ACHIEVEMENT RATE?*/
SELECT SEX, COUNT(NAME) AS `PLAYERS PARTICIPATED`,
sum(if(MEDAL <> 'NA',1,0)) as medal_achieved,
CONCAT(ROUND(COUNT(NAME)/sum(if(MEDAL <> 'NA',1,0)),2),"%")  AS `RATIO OF WINNING`
FROM olympic_report
group by SEX;

/*Q11. PLAYERS PLAYING BASKETBALL ACHIEVING MEDALS WITH 
MIN. HEIGHT RANGE?*/
SELECT NAME,TEAM, SPORT, HEIGHT, MEDAL
FROM olympic_report
WHERE SPORT= 'BASKETBALL' 
AND HEIGHT <> 'NA'
ORDER BY HEIGHT ASC;
